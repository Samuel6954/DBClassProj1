<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>單位員工查詢 | DBProj01_21_ListEmployeeByUnit</title>
  <link rel="stylesheet" href="assets/tech.css" />
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="topbar-inner">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">ERP 稽核輔助｜單位員工查詢</div>
        <div class="breadcrumbs">首頁 / 人事資料 / 單位員工查詢</div>
      </div>
    </header>

    <main class="container">
      <!-- Filter -->
      <section class="panel subtle-grid">
        <div class="panel-header">
          <div class="panel-title">查詢條件</div>
          <div class="panel-actions">
            <button id="btnReset" class="btn" type="button">清除</button>
            <button id="btnFilter" class="btn primary" type="button">查詢</button>
          </div>
        </div>
        <div class="panel-body">
          <div class="grid">
            <div class="col-6">
              <label for="selUnit">僅顯示某單位</label>
              <select id="selUnit"></select>
            </div>
            <div class="col-6">
              <label>&nbsp;</label>
              <div class="badge">提示：點選單位可展開員工</div>
            </div>
          </div>
        </div>
      </section>

      <div class="spacer"></div>

      <!-- Units -->
      <section class="panel" id="panelUnits">
        <div class="panel-header">
          <div class="panel-title">單位清單</div>
          <div class="panel-actions hint" id="unitCountHint">顯示 0，共 0 筆</div>
        </div>
        <div class="panel-body">
          <div class="table-wrap">
            <table id="tblUnits">
              <thead>
                <tr>
                  <th>單位代碼</th>
                  <th>單位名稱</th>
                  <th>主管姓名</th>
                  <th>員工數</th>
                  <th>說明</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <div class="spacer"></div>

      <!-- Employees of unit -->
      <section class="panel" id="panelEmployees">
        <div class="panel-header">
          <div class="panel-title">單位員工 <span id="empUnitTitle" class="badge"></span></div>
          <div class="panel-actions hint" id="empCountHint">尚未選擇單位</div>
        </div>
        <div class="panel-body">
          <div class="table-wrap">
            <table id="tblEmployees">
              <thead>
                <tr>
                  <th>工號</th>
                  <th>姓名</th>
                  <th>職稱</th>
                  <th>E-mail</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <div class="spacer"></div>

      <!-- Programs of employee -->
      <section class="panel" id="panelPrograms">
        <div class="panel-header">
          <div class="panel-title">員工可用程式 <span id="progEmpTitle" class="badge"></span></div>
          <div class="panel-actions hint" id="progCountHint">尚未選擇員工</div>
        </div>
        <div class="panel-body">
          <div class="table-wrap">
            <table id="tblPrograms">
              <thead>
                <tr>
                  <th>程式代碼</th>
                  <th>程式名稱</th>
                  <th>分類</th>
                  <th>說明</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      提示：可使用 <span class="kbd">/</span> 聚焦搜尋，點選單位或員工以展開明細。
    </footer>
  </div>

  <script>
  // Demo data (可替換為後端資料)
  const UNITS = [
    { id: 'HR001', name: '人力資源部', manager: '張一', desc: '人員招募、異動與訓練' },
    { id: 'IT001', name: '資訊管理部', manager: '張二', desc: '系統維運與開發' },
    { id: 'FN001', name: '財務會計部', manager: '張三', desc: '帳務處理與報表' },
  ];

  const EMPLOYEES = [
    { id: 'E1001', name: '王小明', title: '專員', email: 'ming@example.com', unitId: 'HR001' },
    { id: 'E1002', name: '陳小華', title: '助理', email: 'hua@example.com', unitId: 'HR001' },
    { id: 'E2001', name: '林大雄', title: '工程師', email: 'hsiung@example.com', unitId: 'IT001' },
    { id: 'E2002', name: '周佩玲', title: '工程師', email: 'pei@example.com', unitId: 'IT001' },
    { id: 'E3001', name: '張雅婷', title: '會計', email: 'ting@example.com', unitId: 'FN001' },
  ];

  const PROGRAMS_BY_EMP = {
    'E1001': [
      { code: 'PRG_LEAVE', name: '請假系統', cat: 'HR', desc: '員工請假申請與核准' },
      { code: 'PRG_HR_RPT', name: '人事報表', cat: 'HR', desc: '人事統計與報表' },
    ],
    'E1002': [
      { code: 'PRG_LEAVE', name: '請假系統', cat: 'HR', desc: '員工請假申請與核准' },
    ],
    'E2001': [
      { code: 'PRG_ISSUE', name: '問題單', cat: 'IT', desc: '維運問題單管理' },
      { code: 'PRG_DEPLOY', name: '部署工具', cat: 'IT', desc: '系統部署作業' },
    ],
    'E2002': [
      { code: 'PRG_ISSUE', name: '問題單', cat: 'IT', desc: '維運問題單管理' },
    ],
    'E3001': [
      { code: 'PRG_GL', name: '總帳系統', cat: 'FIN', desc: '會計總帳作業' },
      { code: 'PRG_AP', name: '應付系統', cat: 'FIN', desc: '應付帳款作業' },
    ],
  };

  // Elements
  const selUnit = document.getElementById('selUnit');
  const tblUnitsBody = document.querySelector('#tblUnits tbody');
  const unitCountHint = document.getElementById('unitCountHint');

  const tblEmpBody = document.querySelector('#tblEmployees tbody');
  const empUnitTitle = document.getElementById('empUnitTitle');
  const empCountHint = document.getElementById('empCountHint');

  const tblProgBody = document.querySelector('#tblPrograms tbody');
  const progEmpTitle = document.getElementById('progEmpTitle');
  const progCountHint = document.getElementById('progCountHint');

  const btnFilter = document.getElementById('btnFilter');
  const btnReset = document.getElementById('btnReset');

  let currentUnitId = '';
  let currentEmpId = '';

  function countEmployeesByUnit(unitId) {
    return EMPLOYEES.filter(e => e.unitId === unitId).length;
  }

  function renderUnitOptions() {
    selUnit.innerHTML = '';
    const optAll = document.createElement('option');
    optAll.value = '';
    optAll.textContent = '（全部單位）';
    selUnit.appendChild(optAll);
    for (const u of UNITS) {
      const opt = document.createElement('option');
      opt.value = u.id;
      opt.textContent = `${u.id}｜${u.name}`;
      selUnit.appendChild(opt);
    }
  }

  function renderUnits(filterUnitId = '') {
    const list = filterUnitId ? UNITS.filter(u => u.id === filterUnitId) : UNITS;
    tblUnitsBody.innerHTML = '';
    for (const u of list) {
      const tr = document.createElement('tr');
      tr.style.cursor = 'pointer';
      tr.dataset.unitId = u.id;
      tr.innerHTML = `
        <td>${u.id}</td>
        <td>${u.name}</td>
        <td>${u.manager}</td>
        <td>${countEmployeesByUnit(u.id)}</td>
        <td>${u.desc}</td>
      `;
      tr.addEventListener('click', () => selectUnit(u.id));
      tblUnitsBody.appendChild(tr);
    }
    unitCountHint.textContent = `顯示 ${list.length}，共 ${UNITS.length} 筆`;
  }

  function selectUnit(unitId) {
    currentUnitId = unitId;
    selUnit.value = unitId;
    renderUnits(unitId);
    // Render employees of this unit
    const emps = EMPLOYEES.filter(e => e.unitId === unitId);
    tblEmpBody.innerHTML = '';
    for (const e of emps) {
      const tr = document.createElement('tr');
      tr.style.cursor = 'pointer';
      tr.dataset.empId = e.id;
      tr.innerHTML = `
        <td>${e.id}</td>
        <td>${e.name}</td>
        <td>${e.title}</td>
        <td>${e.email}</td>
      `;
      tr.addEventListener('click', () => selectEmployee(e.id));
      tblEmpBody.appendChild(tr);
    }
    empUnitTitle.textContent = unitId ? `單位：${unitId}` : '';
    empCountHint.textContent = `顯示 ${emps.length} 筆`;
    // Clear program panel
    selectEmployee('');
  }

  function selectEmployee(empId) {
    currentEmpId = empId;
    tblProgBody.innerHTML = '';
    if (!empId) {
      progEmpTitle.textContent = '';
      progCountHint.textContent = '尚未選擇員工';
      return;
    }
    const progs = PROGRAMS_BY_EMP[empId] || [];
    for (const p of progs) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.code}</td>
        <td>${p.name}</td>
        <td>${p.cat}</td>
        <td>${p.desc}</td>
      `;
      tblProgBody.appendChild(tr);
    }
    const emp = EMPLOYEES.find(e => e.id === empId);
    progEmpTitle.textContent = emp ? `員工：${emp.id}｜${emp.name}` : '';
    progCountHint.textContent = `顯示 ${progs.length} 筆`;
  }

  // Wire up buttons
  btnFilter.addEventListener('click', () => {
    const unitId = selUnit.value || '';
    if (unitId) {
      selectUnit(unitId);
    } else {
      currentUnitId = '';
      renderUnits('');
      tblEmpBody.innerHTML = '';
      empUnitTitle.textContent = '';
      empCountHint.textContent = '未篩選單位';
      selectEmployee('');
    }
  });

  btnReset.addEventListener('click', () => {
    selUnit.value = '';
    currentUnitId = '';
    currentEmpId = '';
    renderUnits('');
    tblEmpBody.innerHTML = '';
    empUnitTitle.textContent = '';
    empCountHint.textContent = '未篩選單位';
    selectEmployee('');
  });

  // Initialize
  renderUnitOptions();
  renderUnits('');
  empCountHint.textContent = '未篩選單位';
  progCountHint.textContent = '尚未選擇員工';
  </script>
</body>
<!-- DBProj01_21_ListEmployeeByUnit -->
</html>

